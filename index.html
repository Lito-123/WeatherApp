// Select the DOM elements
const getWeatherBtn = document.getElementById('getWeatherBtn');
const cityInput = document.getElementById('cityInput');
const weatherInfo = document.getElementById('weatherInfo');
const location = document.getElementById('location');
const weatherDescription = document.getElementById('weatherDescription');
const temperature = document.getElementById('temperature');
const cloudCover = document.getElementById('cloudCover');
const errorMessage = document.getElementById('errorMessage');

// Event listener for the Get Weather button
getWeatherBtn.addEventListener('click', () => {
    const city = cityInput.value.trim();

    if (city === '') {
        displayError('Please enter a city name.');
        return;
    }

    fetchWeatherData(city);
});

// Function to fetch weather data from MetaWeather API
async function fetchWeatherData(city) {
    // Clear previous data
    weatherInfo.classList.add('hidden');
    errorMessage.classList.add('hidden');

    // Get the WOEID (Where On Earth ID) for the city
    try {
        const response = await fetch(`https://www.metaweather.com/api/location/search/?query=${city}`);
        const data = await response.json();

        if (data.length === 0) {
            displayError('City not found.');
            return;
        }

        const locationData = data[0];
        const woeid = locationData.woeid;

        // Fetch weather forecast for the found city
        const weatherResponse = await fetch(`https://www.metaweather.com/api/location/${woeid}/`);
        const weatherData = await weatherResponse.json();

        displayWeatherData(weatherData);
    } catch (error) {
        displayError('Failed to fetch weather data.');
    }
}

// Function to display weather data
function displayWeatherData(weatherData) {
    const weatherToday = weatherData.consolidated_weather[0]; // Get today's weather
    const city = weatherData.title;
    const description = weatherToday.weather_state_name;
    const temp = weatherToday.the_temp.toFixed(1); // Current temperature
    const cloud = weatherToday.clouds; // Cloud coverage percentage

    location.textContent = city;
    weatherDescription.textContent = description;
    temperature.textContent = `${temp}Â°C`;
    cloudCover.textContent = `Cloud Cover: ${cloud}%`;

    weatherInfo.classList.remove('hidden');
}

// Function to display error message
function displayError(message) {
    errorMessage.textContent = message;
    errorMessage.classList.remove('hidden');
}
