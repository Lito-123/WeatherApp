<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-200 p-5">

    <div id="app" class="max-w-md mx-auto bg-white p-5 rounded-md shadow-md">
        <!-- Latitude and Longitude Display -->
        <div id="locationInfo" class="mb-3 text-sm text-gray-600">
            <p>Latitude: <span id="latitude">Loading...</span></p>
            <p>Longitude: <span id="longitude">Loading...</span></p>
        </div>

        <h1 class="text-2xl font-bold text-center mb-5">Weather Forecast</h1>

        <!-- Form for entering the city -->
        <div class="mb-5">
            <input type="text" id="cityInput" class="p-2 border border-gray-300 rounded-md w-full" placeholder="Enter city name">
            <button id="getWeatherBtn" class="mt-3 p-2 w-full bg-blue-500 text-white rounded-md">Get Weather</button>
        </div>

        <!-- Weather Information -->
        <div id="weatherInfo" class="hidden">
            <h2 class="text-xl font-semibold mb-3" id="location"></h2>
            <p id="weatherDescription" class="mb-2"></p>
            <p id="temperature" class="text-xl font-bold"></p>
            <p id="cloudCover" class="text-sm mt-2"></p>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="hidden text-red-500 text-center mt-4"></div>
    </div>

    <script>
        // Select the DOM elements
        const getWeatherBtn = document.getElementById('getWeatherBtn');
        const cityInput = document.getElementById('cityInput');
        const weatherInfo = document.getElementById('weatherInfo');
        const location = document.getElementById('location');
        const weatherDescription = document.getElementById('weatherDescription');
        const temperature = document.getElementById('temperature');
        const cloudCover = document.getElementById('cloudCover');
        const errorMessage = document.getElementById('errorMessage');
        const latitudeDisplay = document.getElementById('latitude');
        const longitudeDisplay = document.getElementById('longitude');

        // Load weather data for user's current location when the page loads
        window.onload = () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    // Update the latitude and longitude displayed at the top
                    latitudeDisplay.textContent = lat.toFixed(4);
                    longitudeDisplay.textContent = lon.toFixed(4);

                    // Fetch weather for the obtained latitude and longitude
                    await fetchWeatherDataByCoordinates(lat, lon);
                }, (error) => {
                    // Handle error if location access fails
                    displayError('Unable to retrieve your location. Please allow location access.');
                    console.error(error);
                });
            } else {
                displayError('Geolocation is not supported by this browser.');
            }
        };

        // Event listener for the Get Weather button
        getWeatherBtn.addEventListener('click', () => {
            const city = cityInput.value.trim();

            // If the input is empty, show an error
            if (city === '') {
                displayError('Please enter a city name.');
                return;
            }

            // Clear any previous errors and attempt to fetch weather data
            weatherInfo.classList.add('hidden');
            errorMessage.classList.add('hidden');
            displayMessage('Fetching weather data for ' + city + '...');

            fetchWeatherData(city);
        });

        // Function to fetch weather data from MetaWeather API using city name
        async function fetchWeatherData(city) {
            try {
                const response = await fetch(`https://www.metaweather.com/api/location/search/?query=${city}`);
                const data = await response.json();

                // If no results are returned for the city, display an error
                if (data.length === 0) {
                    displayError('City not found.');
                    return;
                }

                const locationData = data[0];
                const woeid = locationData.woeid;

                // Fetch weather forecast for the city
                const weatherResponse = await fetch(`https://www.metaweather.com/api/location/${woeid}/`);
                const weatherData = await weatherResponse.json();

                // Display the location and weather data
                location.textContent = locationData.title;
                displayWeatherData(weatherData);
            } catch (error) {
                // Catch any errors and display them
                displayError('Failed to fetch weather data. Please try again later.');
                console.error(error);
            }
        }

        // Function to fetch weather data from MetaWeather API using latitude and longitude
        async function fetchWeatherDataByCoordinates(lat, lon) {
            try {
                // Fetch weather data for the location using latitude and longitude
                const response = await fetch(`https://www.metaweather.com/api/location/search/?lattlong=${lat},${lon}`);
                const data = await response.json();

                // If no location is found, show an error
                if (data.length === 0) {
                    displayError('Location not found.');
                    return;
                }

                const locationData = data[0];
                const woeid = locationData.woeid;

                // Fetch weather forecast for the found location
                const weatherResponse = await fetch(`https://www.metaweather.com/api/location/${woeid}/`);
                const weatherData = await weatherResponse.json();

                // Display the location and weather data
                location.textContent = locationData.title;
                displayWeatherData(weatherData);
            } catch (error) {
                // Catch any errors and display them
                displayError('Failed to fetch weather data. Please try again later.');
                console.error(error);
            }
        }

        // Function to display weather data
        function displayWeatherData(weatherData) {
            const weatherToday = weatherData.consolidated_weather[0]; // Get today's weather
            const description = weatherToday.weather_state_name;
            const temp = weatherToday.the_temp.toFixed(1); // Current temperature
            const cloud = weatherToday.clouds; // Cloud coverage percentage

            weatherDescription.textContent = description;
            temperature.textContent = `${temp}Â°C`;
            cloudCover.textContent = `Cloud Cover: ${cloud}%`;

            weatherInfo.classList.remove('hidden');
        }

        // Function to display error message
        function displayError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            weatherInfo.classList.add('hidden');
        }

        // Function to display general message (e.g., loading state or success)
        function displayMessage(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }
    </script>
</body>

</html>
